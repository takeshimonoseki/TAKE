<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>相談スタート｜drivers-site（山口県）</title>
  <meta name="description" content="どの相談から始めるか選び、内容をまとめてLINEの送信欄に下書きとして入れます。" />
  <link rel="stylesheet" href="./drivers.css" />
  <script src="./config.js"></script>
</head>
<body>
  <div id="top"></div>

  <header class="site-header" id="top">
    <div class="site-header-inner">
      <div class="header-left">
        <div class="region-badge" aria-label="対応地域">
          <div class="region-en" id="regionEn">YAMAGUCHI</div>
          <div class="region-ja" id="regionJa">山口県</div>
        </div>
        <div class="brand">
          <div class="brand-mark" aria-hidden="true"><span></span></div>
          <div>
            <div class="company-name" id="companyName">軽貨物TAKE</div>
            <div class="brand-text-sub">相談スタート</div>
          </div>
        </div>
      </div>
      <div class="header-right">
        <div class="contact-strip" aria-label="連絡先">
          <div class="contact-item">
            <span class="contact-label">LINE</span>
            <span class="contact-value"><a href="#" id="headerLineLink">相談する</a></span>
          </div>
          <div class="contact-item">
            <span class="contact-label">MAIL</span>
            <span class="contact-value"><a href="#" id="headerMailLink"></a></span>
          </div>
          <div class="contact-item">
            <span class="contact-label">TEL</span>
            <span class="contact-value"><a href="#" id="headerTelLink"></a></span>
          </div>
        </div>
        <nav class="nav" aria-label="メイン">
          <a href="./register.html" class="nav-link nav-link-cta">登録</a>
          <a href="./index.html" class="nav-link">トップ</a>
          <a href="./consult.html" class="nav-link nav-link-primary" aria-current="page">開業相談</a>
          <a href="./vehicle.html" class="nav-link">車両の相談</a>
        </nav>
      </div>
    </div>
  </header>

  <main class="page">

      <article class="card" style="margin-bottom: 14px;">
        <div class="card-inner">
          <h1 class="hero-title" style="margin:0 0 6px;">相談スタート</h1>
          <p class="hero-lead" style="margin:0;">
            選んだ内容＋備考をまとめて、LINEの送信欄に<strong>下書き</strong>として入れます。送信ボタンはあなたが押します。
          </p>
        </div>
      </article>

      <!-- ✅ 最優先：登録へ誘導 -->
      <article class="card" style="margin-bottom: 14px;">
        <div class="card-inner">
          <div class="pill" style="display:inline-flex; gap:8px; align-items:center; margin-bottom:8px;">
            <span class="badge badge-ok">最優先</span>
            <span class="muted">協力ドライバー登録</span>
          </div>
          <h2 class="section-title" style="margin:0 0 8px;">まず登録フォームへ（1分）</h2>
          <p class="muted" style="margin:0 0 12px;">登録が一番うれしいので、相談より先にここだけでもOKです。</p>
          <a class="btn btn-primary" href="./register.html">協力ドライバー登録フォームへ</a>
        </div>
      </article>

      <!-- ✅ 相談：選択→生成→確認→送る -->
      <article class="card" id="consultCard">
        <div class="card-inner">
          <h2 class="section-title" style="margin:0 0 10px;">LINEで相談（内容付き）</h2>

          <div class="columns" style="margin-top: 6px;">
            <section>
              <h3 class="section-title" style="margin:0 0 10px; font-size:16px;">① 相談カテゴリを選ぶ</h3>
              <div class="radio-row" style="display:grid; gap:10px;">
                <label>
                  <input type="radio" name="consultType" value="協力ドライバー登録について" checked>
                  <span><b>協力ドライバー登録について</b><br><span class="muted">登録の流れ／公開範囲／稼働条件など</span></span>
                </label>
                <label>
                  <input type="radio" name="consultType" value="開業トータル相談">
                  <span><b>開業トータル相談</b><br><span class="muted">車両・黒ナンバー・保険・確定申告など全体整理</span></span>
                </label>
                <label>
                  <input type="radio" name="consultType" value="車両購入の相談">
                  <span><b>車両購入の相談</b><br><span class="muted">おすすめ／予算／リース・中古／選び方</span></span>
                </label>
                <label>
                  <input type="radio" name="consultType" value="修理整備の相談">
                  <span><b>修理整備の相談</b><br><span class="muted">症状／見積／整備先の相談</span></span>
                </label>
                <label>
                  <input type="radio" name="consultType" value="その他（クルマ相談）">
                  <span><b>その他（クルマ相談）</b><br><span class="muted">車検・保険・名義・雑談まで</span></span>
                </label>
              </div>

              <div style="margin-top: 12px;">
                <h3 class="section-title" style="margin:0 0 8px; font-size:16px;">② 備考（自由入力）</h3>
                <textarea id="note" class="field" rows="7" placeholder="例）\n・今の状況：未経験／準備中／稼働中\n・希望エリア：〇〇\n・予算感：〇〇\n・困っていること：〇〇\n（ここは例です。送信本文には混ざりません）"></textarea>

                <details style="margin-top:10px;">
                  <summary class="muted">相談例（参考・送信本文には入りません）</summary>
                  <ul class="muted" style="margin:8px 0 0; padding-left: 18px;">
                    <li>開業に必要な手順を、最短で整理してほしい</li>
                    <li>黒ナンバー取得の流れと必要書類を教えてほしい</li>
                    <li>軽バン（中古/リース）のおすすめと相場感を知りたい</li>
                    <li>この症状（異音/警告灯）って修理必要？目安いくら？</li>
                    <li>協力ドライバー登録の流れと公開範囲を確認したい</li>
                  </ul>
                </details>
              </div>

              <div class="actions" style="margin-top: 14px;">
                <a class="btn btn-secondary" id="btnAddFriend" href="#" target="_blank" rel="noopener noreferrer">まず友だち追加</a>
                <button class="btn btn-line" type="button" id="btnBuild">この内容で作る</button>
              </div>

              <p class="muted" style="margin: 10px 0 0;">
                ※ 送信日時は入れません（LINE側で分かるため）。
              </p>
            </section>

            <section>
              <h3 class="section-title" style="margin:0 0 10px; font-size:16px;">③ 確認して送る</h3>
              <p class="muted" style="margin:0;">
                「この内容で作る」を押すと、送信内容のプレビューが<span class="badge badge-soft">ポップアップ</span>で表示されます。
                そこで内容を確認してから「LINEで送る」を押してください。
              </p>
            </section>
          </div>
        </div>
      </article>

  
  <!-- プレビュー（モーダル） -->
  <div class="modal-overlay" id="previewModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-head">
        <h3 class="modal-title" id="modalTitle">送信内容の確認</h3>
        <button type="button" class="icon-btn" id="modalClose" aria-label="閉じる">×</button>
      </div>
      <div class="modal-body">
        <div class="muted" style="margin-bottom:8px;">この内容がLINEの入力欄に入ります（送信はあなたが押します）</div>
        <pre class="modal-pre" id="modalText"></pre>

        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" id="modalEdit">修正する</button>
          <button type="button" class="btn" id="modalCopy">コピー</button>
          <button type="button" class="btn btn-line" id="modalSend">LINEで送る</button>
        </div>

        <div class="small-muted" id="modalHelp">
          LINEが開かない時は、いったん <a href="#" id="modalAddFriend">友だち追加</a> → 戻ってもう一度お試しください。
        </div>
      </div>
    </div>
  </div>

</main>

  <script>
  (function(){
    'use strict';
    var C = window.CONFIG || {};

    // header
    var regionJa = document.getElementById('regionJa');
    var regionEn = document.getElementById('regionEn');
    var companyName = document.getElementById('companyName');

    if (regionJa) regionJa.textContent = C.REGION_LABEL || '山口県';
    if (regionEn) regionEn.textContent = (C.REGION_CODE || 'YAMAGUCHI').toUpperCase();
    if (companyName) companyName.textContent = C.COMPANY_NAME || '軽貨物TAKE';

    var mail = (C.EMAIL_TO || '').trim();
    var tel  = (C.TEL || '').trim();
    var lineAdd = (C.LINE_URL || '').trim();

    var headerLine = document.getElementById('headerLineLink');
    var headerMail = document.getElementById('headerMailLink');
    var headerTel  = document.getElementById('headerTelLink');

    // 相談の入口は「相談スタート」に集約（現在ページなのでリンクは無効化）
    if (headerLine) headerLine.href = './consult.html';
    if (headerMail && mail) { headerMail.href = 'mailto:' + mail; headerMail.textContent = mail; }
    if (headerTel  && tel)  { headerTel.href  = 'tel:' + tel.replace(/[^0-9+]/g,''); headerTel.textContent = tel.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3'); }

    var btnAddFriend = document.getElementById('btnAddFriend');
    if (btnAddFriend && lineAdd) btnAddFriend.href = lineAdd;

    // ===== LINE 下書き =====
    function normalizeOaId(raw){
      var s = String(raw || '').trim();
      if (!s) return '';
      if (s[0] !== '@') s = '@' + s;
      return s;
    }

    function buildMessage(){
      var type = (document.querySelector('input[name="consultType"]:checked') || {}).value || '';
      var note = (document.getElementById('note') || {}).value || '';
      type = String(type).trim();
      note = String(note).trim();
      if (!note) note = '未入力';

      return [
        '【相談カテゴリ】',
        type || '未選択',
        '',
        '【備考】',
        note
      ].join('\n').slice(0, 5000);
    }

    function openLineWithText(text){
      var msg = encodeURIComponent(String(text || '').slice(0, 5000));
      var oa = normalizeOaId(C.LINE_OA_ID || C.LINE_OA || '');
      if (oa){
        var url = 'https://line.me/R/oaMessage/' + encodeURIComponent(oa) + '/?' + msg;
        location.href = url;
        return;
      }
      // fallback（宛先選択になる可能性あり）
      location.href = 'https://line.me/R/msg/text/?' + msg;
    }

    // ===== modal =====
    var modal = document.getElementById('previewModal');
    var modalText = document.getElementById('modalText');
    var modalClose = document.getElementById('modalClose');
    var modalEdit = document.getElementById('modalEdit');
    var modalSend = document.getElementById('modalSend');
    var modalCopy = document.getElementById('modalCopy');
    var modalAddFriend = document.getElementById('modalAddFriend');

    if (modalAddFriend && lineAdd) modalAddFriend.href = lineAdd;

    function openModal(text){
      if (!modal) return;
      modalText.textContent = text;
      modal.classList.add('is-open');
      modal.setAttribute('aria-hidden','false');
      document.documentElement.style.overflow = 'hidden';
    }
    function closeModal(){
      if (!modal) return;
      modal.classList.remove('is-open');
      modal.setAttribute('aria-hidden','true');
      document.documentElement.style.overflow = '';
    }

    function copyText(text){
      if (!text) return;
      if (navigator.clipboard && navigator.clipboard.writeText){
        navigator.clipboard.writeText(text).catch(function(){});
        return;
      }
      // fallback
      var ta = document.createElement('textarea');
      ta.value = text;
      ta.style.position = 'fixed';
      ta.style.opacity = '0';
      document.body.appendChild(ta);
      ta.select();
      try { document.execCommand('copy'); } catch(e){}
      ta.remove();
    }

    var btnBuild = document.getElementById('btnBuild');
    if (btnBuild) btnBuild.addEventListener('click', function(){
      openModal(buildMessage());
    });

    if (modalClose) modalClose.addEventListener('click', closeModal);
    if (modalEdit) modalEdit.addEventListener('click', function(){
      closeModal();
      var noteEl = document.getElementById('note');
      if (noteEl) noteEl.focus();
    });
    if (modalCopy) modalCopy.addEventListener('click', function(){
      copyText(modalText ? modalText.textContent : buildMessage());
    });
    if (modalSend) modalSend.addEventListener('click', function(){
      openLineWithText(modalText ? modalText.textContent : buildMessage());
    });

    // overlay click
    if (modal) modal.addEventListener('click', function(e){
      if (e.target === modal) closeModal();
    });

    document.addEventListener('keydown', function(e){
      if (e.key === 'Escape') closeModal();
    });
  })();
</script>
</body>
</html>
